---
layout:     post
title:      arm64	
subtitle:    arm64
date:       2018-11-8
author:     XT
header-img: img/post-bg-coffee.jpeg
catalog: 	 true
tags:
    - pwn
    - 环境配置
---




> aarch64环境的搭建/简单的了解一下搭建,做题的先没有

​	https://xz.aliyun.com/t/3154#toc-2

​	http://blog.binpang.me/2018/07/26/qemu-arm/

​	https://ctf-wiki.github.io/ctf-wiki/pwn/linux/arm/environment/



## 预备环境安装：

- 安装 git，gdb 和 gdb-multiarch，同时安装 binfmt 用来识别文件类型

  ```shell
$ sudo apt-get update
$ sudo apt-get install git gdb gdb-multiarch
$ sudo apt-get install "binfmt*"
  ```

- 安装 gdb 的插件 pwndbg（或者 gef 等 gdb plugin）

  ```
  $ git clone https://github.com/pwndbg/pwndbg
  $ cd pwndbg
  $ ./setup.sh
  ```

- 安装 pwntools，不必要，但绝对是写 exp 的神器

   ```
$ sudo pip install pwntools
   ```

## 安装 qemu：

* 我们对版本的要求不是很严格, 直接通过 apt 等包管理安装即可

   ```
   $ sudo apt-get install qemu-user
   ```

   通过 qemu 模拟 arm/mips 环境，进而进行运行和调试



## 安装共享库：

​	可以直接使用 `apt` 安装 `arm` 的动态库，然后用 `qemu` 运行即可。 

   ```
sudo apt-get install -y gcc-aarch64-linux-gnu g++-aarch64-linux-gnu
   ```

​	此时已经可以运行静态链接的 arm binary 了

​	但还不能运行动态链接的 binary 

​	使用 -L 指定共享库路径：

   ```
$ qemu-mipsel -L /usr/mipsel-linux-gnu/ ./add
   ```

​	可以使用 qemu 的 -g 指定端口

   ```
$ qemu-mipsel -g 1234 -L /usr/mipsel-linux-gnu/ ./add
   ```

​	然后使用 gdb-multiarch 进行调试，先指定架构，然后使用 remote 功能

![img](https://raw.githubusercontent.com/xineting/xineting.github.io/master/img/006AWYXBly1fq5dbufgrjj31400p013o.jpg) 

   ```
pwndbg> set architecture mips (但大多数情况下这一步可以省略, 似乎 pwndbg 能自动识别架构)
pwndbg> target remote localhost:1234
   ```

​这样我们就能进行调试了  

下面在使用 `socat` 搭建这个题， 方便输入一些 不可见的字符。

   ```
socat tcp-l:10002,fork exec:"qemu-aarch64 -g 1234  -L /usr/aarch64-linux-gnu ./pwn",reuseaddr
   ```

命令作用为 监听在 `10002` 端口， 每有一个连接过来，就执行

   ```
qemu-aarch64 -g 1234  -L /usr/aarch64-linux-gnu ./pwn
   ```

此时我们可以把调试器 `attach` 上去调试目标程序。

可以在脚本中，当连接服务器后，暂停执行，等待调试器 `attach` 。

   ```
p = remote("127.0.0.1", 10002)
pause()  # 等待调试 attach ，并让目标程序继续执行
   ```
